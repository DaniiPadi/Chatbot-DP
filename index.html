<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diana Padilla Spa - Asistente Virtual</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #ff6b9d;
            --secondary: #c44569;
            --accent: #f8b500;
            --dark: #1a1a2e;
            --darker: #16213e;
            --light: #eee;
            --white: #ffffff;
            --gradient: linear-gradient(135deg, #ff6b9d, #c44569, #f8b500);
            --shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--dark);
            color: var(--white);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* Animated Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(255, 107, 157, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(196, 69, 105, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(248, 181, 0, 0.05) 0%, transparent 50%);
            z-index: -1;
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(2deg); }
            66% { transform: translateY(10px) rotate(-1deg); }
        }

        /* Header */
        .header {
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            padding: 1.5rem 0;
            text-align: center;
            border-bottom: 1px solid rgba(255, 107, 157, 0.2);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1rem;
            font-weight: 300;
        }

        /* Chat Container */
        .chat-container {
            flex: 1;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 120px);
        }

        .chat-messages {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            scroll-behavior: smooth;
        }

        .message {
            display: flex;
            gap: 1rem;
            max-width: 80%;
            animation: slideIn 0.3s ease;
        }

        .user-message {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .bot-message {
            align-self: flex-start;
        }

        .message-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
            box-shadow: var(--shadow);
        }

        .bot-message .message-avatar {
            background: var(--gradient);
            color: white;
        }

        .user-message .message-avatar {
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
            backdrop-filter: blur(10px);
        }

        .message-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            padding: 1rem 1.5rem;
            border-radius: 20px;
            border: 1px solid rgba(255, 107, 157, 0.2);
            font-size: 0.95rem;
            line-height: 1.6;
            box-shadow: var(--shadow);
        }

        .user-message .message-content {
            background: var(--gradient);
            color: white;
            border: none;
        }

        .message-time {
            font-size: 0.75rem;
            opacity: 0.6;
            margin-top: 0.5rem;
        }

        /* Interactive Buttons */
        .interactive-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            margin-top: 1rem;
        }

        .option-btn {
            background: rgba(255, 107, 157, 0.2);
            border: 1px solid var(--primary);
            border-radius: 20px;
            padding: 0.6rem 1.2rem;
            color: var(--white);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            backdrop-filter: blur(10px);
        }

        .option-btn:hover {
            background: var(--gradient);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.3);
        }

        .whatsapp-btn {
            background: linear-gradient(135deg, #25D366, #128C7E);
            border: none;
            border-radius: 25px;
            padding: 0.8rem 1.5rem;
            color: white;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            margin: 0.5rem 0;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .whatsapp-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(37, 211, 102, 0.4);
        }

        /* Input Area */
        .chat-input {
            padding: 2rem;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 107, 157, 0.2);
        }

        .input-container {
            display: flex;
            gap: 1rem;
            max-width: 900px;
            margin: 0 auto;
        }

        .message-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 107, 157, 0.3);
            border-radius: 25px;
            padding: 1rem 1.5rem;
            color: var(--white);
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .message-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(255, 107, 157, 0.3);
        }

        .message-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .send-button {
            background: var(--gradient);
            border: none;
            border-radius: 50%;
            width: 55px;
            height: 55px;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
        }

        .send-button:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 40px rgba(255, 107, 157, 0.4);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: none;
            align-items: center;
            gap: 1rem;
            max-width: 80%;
            animation: slideIn 0.3s ease;
        }

        .typing-dots {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            padding: 1rem 1.5rem;
            border-radius: 20px;
            border: 1px solid rgba(255, 107, 157, 0.2);
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary);
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        .typing-dot:nth-child(3) { animation-delay: 0s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            margin-bottom: 1rem;
            justify-content: center;
        }

        .quick-action {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 107, 157, 0.3);
            border-radius: 20px;
            padding: 0.6rem 1.2rem;
            color: var(--white);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }

        .quick-action:hover {
            background: var(--gradient);
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.3);
        }

        /* Welcome Message */
        .welcome-message {
            text-align: center;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            margin: 1rem;
            border: 1px solid rgba(255, 107, 157, 0.2);
            backdrop-filter: blur(20px);
        }

        .welcome-message h2 {
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .welcome-message p {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 1.5rem;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .header p {
                font-size: 0.9rem;
            }

            .chat-messages {
                padding: 1rem;
            }

            .chat-input {
                padding: 1rem;
            }

            .message {
                max-width: 95%;
            }

            .message-content {
                padding: 0.8rem 1rem;
                font-size: 0.9rem;
            }

            .quick-actions {
                flex-direction: column;
            }

            .quick-action {
                text-align: center;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gradient);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>üíÑ DIANA PADILLA EST√âTICA & SPA</h1>
        <p>Tu Asistente Virtual Inteligente - Preg√∫ntame cualquier cosa</p>
    </header>

    <div class="chat-container">
        <div class="chat-messages" id="chatMessages">
            <div class="welcome-message">
                <h2>¬°Bienvenida a Diana Padilla Spa! ‚ú®</h2>
                <p>Soy tu asistente virtual inteligente. Puedo ayudarte con servicios, precios, horarios, ubicaci√≥n y agendar tu cita perfecta.</p>
                <div class="quick-actions">
                    <div class="quick-action" onclick="showMenuServicios()">üé® Ver Servicios</div>
                    <div class="quick-action" onclick="showMenuPrecios()">üí∞ Ver Precios</div>
                    <div class="quick-action" onclick="sendQuickMessage('horarios')">üïê Horarios</div>
                    <div class="quick-action" onclick="sendQuickMessage('ubicacion')">üìç Ubicaci√≥n</div>
                    <div class="quick-action" onclick="agendarCitaWhatsApp()">üìÖ Agendar Cita</div>
                </div>
            </div>

            <div class="typing-indicator" id="typingIndicator">
                <div class="message-avatar">
                    üíÑ
                </div>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
        </div>

        <div class="chat-input">
            <div class="input-container">
                <input 
                    type="text" 
                    class="message-input" 
                    id="messageInput" 
                    placeholder="Preg√∫ntame sobre cortes, manicura, precios, horarios... üí¨"
                    onkeypress="handleKeyPress(event)"
                >
                <button class="send-button" id="sendButton" onclick="sendMessage()">
                    ‚û§
                </button>
            </div>
        </div>
    </div>

    <script>
        // Informaci√≥n completa y detallada del spa
        const spaInfo = {
            nombre: "Diana Padilla Est√©tica & Spa",
            descripcion: "Spa de lujo especializado en belleza y bienestar, donde cada tratamiento es una experiencia √∫nica.",
            ubicacion: "Guayaquil, Ecuador",
            telefono: "+593 98 799 3614",
            whatsapp: "593987993614",
            email: "info@dianapaspa.com",
            
            horarios: {
                dias: "Lunes a S√°bado",
                horario1: "9:00 AM - 1:00 PM",
                horario2: "2:00 PM - 7:00 PM",
                descanso: "Domingos cerrado"
            },

            servicios: {
                capilar: {
                    nombre: "üíá‚Äç‚ôÄÔ∏è Arte Capilar",
                    descripcion: "Servicios profesionales para tu cabello",
                    items: [
                        { nombre: "Cortes de dama", precio: "Desde $15", descripcion: "Cortes modernos y cl√°sicos para damas" },
                        { nombre: "Cortes de hombre", precio: "Desde $12", descripcion: "Cortes masculinos profesionales" },
                        { nombre: "Alisado con keratina", precio: "$80", descripcion: "Alisado profesional que dura meses" },
                        { nombre: "Ondulaciones", precio: "$25", descripcion: "Ondas perfectas y naturales" },
                        { nombre: "Tintes y rayitos", precio: "Desde $30", descripcion: "Coloraci√≥n completa, rayitos, marmoleados" },
                        { nombre: "Balayage y californiana", precio: "$60", descripcion: "T√©cnicas de coloraci√≥n premium" },
                        { nombre: "Alta frecuencia capilar", precio: "$20", descripcion: "Tratamiento para fortalecer el cabello" },
                        { nombre: "Repolarizaci√≥n capilar", precio: "$35", descripcion: "Reparaci√≥n profunda del cabello da√±ado" },
                        { nombre: "Extensiones cosidas", precio: "$100", descripcion: "Extensiones de alta calidad cosidas profesionalmente" },
                        { nombre: "Peinados especiales", precio: "Desde $20", descripcion: "Peinados para eventos y ocasiones especiales" },
                        { nombre: "Pulido de horquillas", precio: "$15", descripcion: "Tratamiento para alisar y dar brillo" }
                    ]
                },
                unas: {
                    nombre: "üíÖ Manicura & Pedicura",
                    descripcion: "Cuidado profesional para tus u√±as",
                    items: [
                        { nombre: "Manicura tradicional", precio: "$12", descripcion: "Manicura cl√°sica con esmaltado" },
                        { nombre: "Manicura en gel", precio: "$18", descripcion: "Manicura con esmalte gel de larga duraci√≥n" },
                        { nombre: "Pedicura completa", precio: "$20", descripcion: "Cuidado completo para tus pies" },
                        { nombre: "Extensi√≥n de u√±as", precio: "$25", descripcion: "U√±as m√°s largas y elegantes" },
                        { nombre: "Baby boomer y encapsulados", precio: "$30", descripcion: "T√©cnicas avanzadas de nail art" },
                        { nombre: "U√±as acr√≠licas y gel", precio: "$28", descripcion: "U√±as resistentes y duraderas" }
                    ]
                },
                cejas: {
                    nombre: "üëÅÔ∏è Cejas & Pesta√±as",
                    descripcion: "Realza tu mirada con nuestros tratamientos",
                    items: [
                        { nombre: "Microblading/Microshading", precio: "$120", descripcion: "Cejas perfectas con t√©cnica de micropigmentaci√≥n" },
                        { nombre: "Lash lifting efecto rimel", precio: "$35", descripcion: "Pesta√±as curvadas naturalmente" },
                        { nombre: "Cejas con henna", precio: "$15", descripcion: "Tinte natural para cejas m√°s definidas" },
                        { nombre: "Laminado de cejas", precio: "$25", descripcion: "Cejas m√°s voluminosas y ordenadas" },
                        { nombre: "Pesta√±as punto a punto", precio: "$40", descripcion: "Extensiones de pesta√±as individuales" },
                        { nombre: "Depilaci√≥n con hilo", precio: "$8", descripcion: "Depilaci√≥n precisa y delicada" }
                    ]
                },
                facial: {
                    nombre: "‚ú® Tratamientos Faciales",
                    descripcion: "Cuidado especializado para tu rostro",
                    items: [
                        { nombre: "Limpieza facial profunda", precio: "$35", descripcion: "Limpieza completa y hidrataci√≥n facial" },
                        { nombre: "Exfoliaci√≥n corporal", precio: "$40", descripcion: "Renovaci√≥n completa de la piel" },
                        { nombre: "Makeup profesional", precio: "Desde $25", descripcion: "Maquillaje para eventos especiales" },
                        { nombre: "Depilaci√≥n corporal con cera", precio: "Desde $15", descripcion: "Depilaci√≥n suave y duradera" }
                    ]
                },
                relajacion: {
                    nombre: "üåø Bienestar & Relajaci√≥n",
                    descripcion: "Momentos de paz y relajaci√≥n",
                    items: [
                        { nombre: "Masajes relajantes", precio: "$45", descripcion: "Masajes terap√©uticos para tu bienestar" }
                    ]
                }
            },

            // Palabras clave para b√∫squeda inteligente
            keywords: {
                cortes: ["corte", "cortar", "cabello", "pelo", "tijera"],
                manicura: ["u√±as", "manicura", "esmalte", "nail"],
                cejas: ["cejas", "pesta√±as", "microblading", "henna"],
                facial: ["facial", "limpieza", "cara", "rostro"],
                precios: ["precio", "costo", "cuanto", "valor"],
                horarios: ["hora", "horario", "abierto", "cerrado"],
                ubicacion: ["donde", "ubicacion", "direccion", "lugar"]
            }
        };

        let conversationHistory = [];

        // Funci√≥n para agendar cita por WhatsApp
        function agendarCitaWhatsApp() {
            const mensaje = "¬°Hola Diana! üëã Quiero agendar una cita en tu spa. ¬øPodr√≠as ayudarme con la disponibilidad?";
            const whatsappURL = `https://wa.me/${spaInfo.whatsapp}?text=${encodeURIComponent(mensaje)}`;
            window.open(whatsappURL, '_blank');
        }

        // Funci√≥n para agendar servicio espec√≠fico
        function agendarServicioWhatsApp(servicio, precio) {
            const mensaje = `¬°Hola Diana! üëã\n\nQuiero agendar una cita para:\nüé® Servicio: ${servicio}\nüí∞ Precio: ${precio}\n\n¬øCu√°l ser√≠a la disponibilidad? ¬°Gracias!`;
            const whatsappURL = `https://wa.me/${spaInfo.whatsapp}?text=${encodeURIComponent(mensaje)}`;
            window.open(whatsappURL, '_blank');
        }

        // Men√∫s interactivos
        function showMenuServicios() {
            const opciones = Object.keys(spaInfo.servicios).map(key => 
                `<div class="option-btn" onclick="showCategoriaServicios('${key}')">${spaInfo.servicios[key].nombre}</div>`
            ).join('');
            
            addBotMessageWithOptions("üé® **Nuestros servicios por categor√≠as:**\n\nSelecciona la categor√≠a que te interesa:", opciones);
        }

        function showMenuPrecios() {
            const opciones = Object.keys(spaInfo.servicios).map(key => 
                `<div class="option-btn" onclick="showPreciosCategoria('${key}')">${spaInfo.servicios[key].nombre}</div>`
            ).join('');
            
            addBotMessageWithOptions("üí∞ **Ver precios por categor√≠a:**\n\nElige la categor√≠a para ver precios detallados:", opciones);
        }

        function showCategoriaServicios(categoria) {
            const cat = spaInfo.servicios[categoria];
            let mensaje = `${cat.nombre}\n\n${cat.descripcion}\n\n`;
            
            cat.items.forEach(item => {
                mensaje += `‚Ä¢ **${item.nombre}** - ${item.precio}\n  ${item.descripcion}\n\n`;
            });

            const whatsappBtn = `<button class="whatsapp-btn" onclick="agendarCitaWhatsApp()">üì± Agendar por WhatsApp</button>`;
            addBotMessage(mensaje + whatsappBtn);
        }

        function showPreciosCategoria(categoria) {
            const cat = spaInfo.servicios[categoria];
            let mensaje = `üí∞ **${cat.nombre} - Precios**\n\n`;
            
            cat.items.forEach(item => {
                mensaje += `‚Ä¢ ${item.nombre}: **${item.precio}**\n`;
            });

            const opciones = cat.items.map(item => 
                `<div class="option-btn" onclick="agendarServicioWhatsApp('${item.nombre}', '${item.precio}')">Agendar ${item.nombre}</div>`
            ).join('');

            addBotMessageWithOptions(mensaje, opciones);
        }

        // Inicializar chat
        document.addEventListener('DOMContentLoaded', function() {
            addBotMessage("¬°Hola! üëã Soy tu asistente virtual inteligente de Diana Padilla Est√©tica & Spa.\n\nPuedo ayudarte con:\n‚ú® Informaci√≥n detallada de servicios\nüí∞ Precios espec√≠ficos\nüïê Horarios y disponibilidad\nüìç Ubicaci√≥n\nüìÖ Agendar tu cita\n\n¬øEn qu√© puedo ayudarte hoy?");
        });

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function sendQuickMessage(message) {
            addUserMessage(message);
            
            showTyping(true);
            setTimeout(async () => {
                const response = await getBotResponse(message);
                showTyping(false);
                addBotMessage(response);
            }, 1000);
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addUserMessage(message);
            input.value = '';
            
            showTyping(true);
            
            setTimeout(async () => {
                try {
                    const response = await getBotResponse(message);
                    showTyping(false);
                    addBotMessage(response);
                } catch (error) {
                    showTyping(false);
                    addBotMessage("Lo siento, hubo un error. Por favor intenta de nuevo.");
                }
            }, 1200);
        }

        function addUserMessage(message) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user-message';
            
            messageDiv.innerHTML = `
                <div class="message-avatar">üë§</div>
                <div class="message-content">
                    ${message}
                    <div class="message-time">${getCurrentTime()}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        function addBotMessage(message) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot-message';
            
            // Procesar botones en el mensaje
            const processedMessage = message.replace(
                /<button([^>]*)>([^<]*)<\/button>/g, 
                '<button $1>$2</button>'
            );
            
            messageDiv.innerHTML = `
                <div class="message-avatar">üíÑ</div>
                <div class="message-content">
                    ${processedMessage}
                    <div class="message-time">${getCurrentTime()}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        function addBotMessageWithOptions(message, options) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot-message';
            
            messageDiv.innerHTML = `
                <div class="message-avatar">üíÑ</div>
                <div class="message-content">
                    ${message}
                    <div class="interactive-options">
                        ${options}
                    </div>
                    <div class="message-time">${getCurrentTime()}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        function showTyping(show) {
            const typingIndicator = document.getElementById('typingIndicator');
            const sendButton = document.getElementById('sendButton');
            
            typingIndicator.style.display = show ? 'flex' : 'none';
            sendButton.disabled = show;
            
            if (show) {
                scrollToBottom();
            }
        }

        function scrollToBottom() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function getCurrentTime() {
            return new Date().toLocaleTimeString('es-ES', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        // Funci√≥n de inteligencia mejorada para entender consultas
        function findRelevantService(query) {
            const lowerQuery = query.toLowerCase();
            const results = [];
            
            // Buscar en todas las categor√≠as y servicios
            for (const [catKey, categoria] of Object.entries(spaInfo.servicios)) {
                for (const item of categoria.items) {
                    const itemName = item.nombre.toLowerCase();
                    const itemDesc = item.descripcion.toLowerCase();
                    
                    // Verificar coincidencias exactas o parciales
                    if (itemName.includes(lowerQuery) || 
                        itemDesc.includes(lowerQuery) ||
                        lowerQuery.includes(itemName.split(' ')[0]) ||
                        checkKeywordMatch(lowerQuery, itemName)) {
                        results.push({
                            categoria: categoria.nombre,
                            item: item,
                            relevance: calculateRelevance(lowerQuery, itemName, itemDesc)
                        });
                    }
                }
            }
            
            // Ordenar por relevancia
            return results.sort((a, b) => b.relevance - a.relevance);
        }

        function checkKeywordMatch(query, itemName) {
            // Palabras clave espec√≠ficas para b√∫squeda inteligente
            const keywords = {
                'corte': ['corte', 'cortes', 'cortar'],
                'manicura': ['manicura', 'u√±as', 'esmalte'],
                'pedicura': ['pedicura', 'pies'],
                'cejas': ['cejas', 'ceja'],
                'pesta√±as': ['pesta√±as', 'pesta√±a', 'lash'],
                'facial': ['facial', 'cara', 'rostro'],
                'masaje': ['masaje', 'relajante'],
                'alisado': ['alisado', 'keratina', 'liso'],
                'tinte': ['tinte', 'color', 'rayitos'],
                'microblading': ['microblading', 'micropigmentacion']
            };
            
            for (const [key, values] of Object.entries(keywords)) {
                if (values.some(keyword => query.includes(keyword)) && 
                    itemName.toLowerCase().includes(key)) {
                    return true;
                }
            }
            return false;
        }

        function calculateRelevance(query, itemName, itemDesc) {
            let score = 0;
            const queryWords = query.split(' ');
            const nameWords = itemName.toLowerCase().split(' ');
            
            // Coincidencia exacta en nombre
            if (itemName.toLowerCase() === query) score += 100;
            
            // Coincidencias parciales
            queryWords.forEach(qWord => {
                if (qWord.length > 2) {
                    if (itemName.toLowerCase().includes(qWord)) score += 10;
                    if (itemDesc.toLowerCase().includes(qWord)) score += 5;
                }
            });
            
            return score;
        }

        async function getBotResponse(userMessage) {
            conversationHistory.push({ role: "user", content: userMessage });
            
            const message = userMessage.toLowerCase();
            
            // Respuestas inteligentes para consultas espec√≠ficas
            
            // B√∫squeda de servicios espec√≠ficos
            if (message.includes('corte') || message.includes('cortar')) {
                const cortesData = spaInfo.servicios.capilar.items.filter(item => 
                    item.nombre.toLowerCase().includes('corte')
                );
                
                let respuesta = "‚úÇÔ∏è **Nuestros servicios de cortes:**\n\n";
                cortesData.forEach(corte => {
                    respuesta += `‚Ä¢ **${corte.nombre}** - ${corte.precio}\n  ${corte.descripcion}\n\n`;
                });
                
                const opciones = cortesData.map(corte => 
                    `<div class="option-btn" onclick="agendarServicioWhatsApp('${corte.nombre}', '${corte.precio}')">Agendar ${corte.nombre}</div>`
                ).join('');
                
                addBotMessageWithOptions(respuesta, opciones);
                return;
            }

            // Manicura y u√±as
            if (message.includes('manicura') || message.includes('u√±as') || message.includes('nail')) {
                const manicuraData = spaInfo.servicios.unas;
                
                let respuesta = `${manicuraData.nombre}\n\n${manicuraData.descripcion}\n\n`;
                manicuraData.items.forEach(item => {
                    respuesta += `‚Ä¢ **${item.nombre}** - ${item.precio}\n  ${item.descripcion}\n\n`;
                });
                
                const opciones = manicuraData.items.map(item => 
                    `<div class="option-btn" onclick="agendarServicioWhatsApp('${item.nombre}', '${item.precio}')">Agendar ${item.nombre}</div>`
                ).join('');
                
                addBotMessageWithOptions(respuesta, opciones);
                return;
            }

            // Cejas y pesta√±as
            if (message.includes('cejas') || message.includes('pesta√±as') || message.includes('microblading')) {
                const cejasData = spaInfo.servicios.cejas;
                
                let respuesta = `${cejasData.nombre}\n\n${cejasData.descripcion}\n\n`;
                cejasData.items.forEach(item => {
                    respuesta += `‚Ä¢ **${item.nombre}** - ${item.precio}\n  ${item.descripcion}\n\n`;
                });
                
                const opciones = cejasData.items.map(item => 
                    `<div class="option-btn" onclick="agendarServicioWhatsApp('${item.nombre}', '${item.precio}')">Agendar ${item.nombre}</div>`
                ).join('');
                
                addBotMessageWithOptions(respuesta, opciones);
                return;
            }

            // B√∫squeda general de servicios
            const serviciosEncontrados = findRelevantService(message);
            if (serviciosEncontrados.length > 0) {
                let respuesta = "üéØ **Encontr√© estos servicios para ti:**\n\n";
                
                serviciosEncontrados.slice(0, 5).forEach(resultado => {
                    const item = resultado.item;
                    respuesta += `‚Ä¢ **${item.nombre}** - ${item.precio}\n  ${item.descripcion}\n  Categor√≠a: ${resultado.categoria}\n\n`;
                });
                
                const opciones = serviciosEncontrados.slice(0, 3).map(resultado => {
                    const item = resultado.item;
                    return `<div class="option-btn" onclick="agendarServicioWhatsApp('${item.nombre}', '${item.precio}')">Agendar ${item.nombre}</div>`;
                }).join('');
                
                addBotMessageWithOptions(respuesta, opciones);
                return;
            }

            // Precios generales
            if (message.includes('precio') || message.includes('costo') || message.includes('cuanto')) {
                return `üí∞ **Algunos de nuestros precios principales:**\n\n‚úÇÔ∏è **Cortes:**\n‚Ä¢ Dama: Desde $15\n‚Ä¢ Hombre: Desde $12\n\nüíÖ **Manicura:**\n‚Ä¢ Tradicional: $12\n‚Ä¢ En gel: $18\n\nüëÅÔ∏è **Cejas & Pesta√±as:**\n‚Ä¢ Microblading: $120\n‚Ä¢ Lash lifting: $35\n\n‚ú® **Faciales:**\n‚Ä¢ Limpieza profunda: $35\n‚Ä¢ Makeup: Desde $25\n\nüåø **Relajaci√≥n:**\n‚Ä¢ Masajes: $45\n\n<button class="whatsapp-btn" onclick="agendarCitaWhatsApp()">üì± Agendar por WhatsApp</button>\n\n¬øTe interesa alg√∫n servicio en particular?`;
            }

            // Horarios
            if (message.includes('hora') || message.includes('horario') || message.includes('abierto')) {
                return `üïê **Nuestros horarios de atenci√≥n:**\n\nüìÖ **${spaInfo.horarios.dias}:**\n‚Ä¢ Ma√±ana: ${spaInfo.horarios.horario1}\n‚Ä¢ Tarde: ${spaInfo.horarios.horario2}\n\nüè† **${spaInfo.horarios.descanso}**\n\n<button class="whatsapp-btn" onclick="agendarCitaWhatsApp()">üì± Agendar mi cita</button>\n\n¬øTe gustar√≠a reservar alg√∫n horario espec√≠fico?`;
            }

            // Ubicaci√≥n
            if (message.includes('ubicacion') || message.includes('donde') || message.includes('direccion')) {
                return `üìç **Nuestra ubicaci√≥n:**\n${spaInfo.ubicacion}\n\nüìû **Contacto directo:**\n‚Ä¢ Tel√©fono: ${spaInfo.telefono}\n‚Ä¢ WhatsApp: ${spaInfo.telefono}\n‚Ä¢ Email: ${spaInfo.email}\n\n<button class="whatsapp-btn" onclick="agendarCitaWhatsApp()">üì± Escribir por WhatsApp</button>\n\n¬øNecesitas indicaciones espec√≠ficas para llegar?`;
            }

            // Agendar citas
            if (message.includes('cita') || message.includes('reserva') || message.includes('agendar')) {
                const opciones = `
                    <div class="option-btn" onclick="showMenuServicios()">Ver todos los servicios</div>
                    <div class="option-btn" onclick="agendarCitaWhatsApp()">Agendar ahora</div>
                `;
                
                addBotMessageWithOptions(`üìÖ **¬°Perfecto! Te ayudo a agendar tu cita:**\n\nüéØ **Opciones disponibles:**\n‚Ä¢ Puedes explorar nuestros servicios primero\n‚Ä¢ O agendar directamente por WhatsApp\n\nüïê **Disponibilidad:**\n${spaInfo.horarios.dias} de ${spaInfo.horarios.horario1} y ${spaInfo.horarios.horario2}`, opciones);
                return;
            }

            // Respuesta de Claude AI como fallback
            try {
                const prompt = `Eres el asistente virtual de Diana Padilla Est√©tica & Spa. Un cliente te pregunta: "${userMessage}"\n\nINFORMACI√ìN COMPLETA DEL SPA:\n\nSERVICIOS:\n${Object.values(spaInfo.servicios).map(cat => `${cat.nombre}:\n${cat.items.map(item => `‚Ä¢ ${item.nombre} - ${item.precio}: ${item.descripcion}`).join('\n')}`).join('\n\n')}\n\nHORARIOS: ${spaInfo.horarios.dias} de ${spaInfo.horarios.horario1} y ${spaInfo.horarios.horario2}. ${spaInfo.horarios.descanso}.\n\nUBICACI√ìN: ${spaInfo.ubicacion}\nCONTACTO: ${spaInfo.telefono}\n\nResponde de manera profesional, amigable y √∫til. Incluye emojis. M√°ximo 120 palabras. Si es apropiado, sugiere agendar por WhatsApp.`;

                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 300,
                        messages: [{ role: "user", content: prompt }]
                    })
                });

                if (!response.ok) throw new Error('API error');

                const data = await response.json();
                let botResponse = data.content[0].text;
                
                // Agregar bot√≥n de WhatsApp si es apropiado
                if (message.includes('agendar') || message.includes('cita') || message.includes('precio')) {
                    botResponse += '\n\n<button class="whatsapp-btn" onclick="agendarCitaWhatsApp()">üì± Agendar por WhatsApp</button>';
                }
                
                conversationHistory.push({ role: "assistant", content: botResponse });
                return botResponse;
                
            } catch (error) {
                return getLocalFallbackResponse(userMessage);
            }
        }

        function getLocalFallbackResponse(userMessage) {
            const responses = [
                `¬°Hola! üòä Soy tu asistente de Diana Padilla Spa. Puedo ayudarte con:\n\n‚ú® Informaci√≥n de servicios\nüí∞ Precios detallados\nüïê Horarios\nüìç Ubicaci√≥n\nüìÖ Agendar citas\n\n¬øEn qu√© te puedo ayudar espec√≠ficamente?`,
                `üé® **En Diana Padilla Spa tenemos:**\n\nüíá‚Äç‚ôÄÔ∏è Arte Capilar\nüíÖ Manicura & Pedicura\nüëÅÔ∏è Cejas & Pesta√±as\n‚ú® Tratamientos Faciales\nüåø Masajes & Relajaci√≥n\n\n<button class="whatsapp-btn" onclick="agendarCitaWhatsApp()">üì± Agendar por WhatsApp</button>\n\n¬øQu√© servicio te interesa?`
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }
    </script>
</body>
</html>
