<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diana Padilla Spa - Asistente Virtual</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #ff6b9d;
            --secondary: #c44569;
            --accent: #f8b500;
            --dark: #1a1a2e;
            --darker: #16213e;
            --light: #eee;
            --white: #ffffff;
            --gradient: linear-gradient(135deg, #ff6b9d, #c44569, #f8b500);
            --shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--dark);
            color: var(--white);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* Animated Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(255, 107, 157, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(196, 69, 105, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(248, 181, 0, 0.05) 0%, transparent 50%);
            z-index: -1;
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(2deg); }
            66% { transform: translateY(10px) rotate(-1deg); }
        }

        /* Header */
        .header {
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            padding: 1.5rem 0;
            text-align: center;
            border-bottom: 1px solid rgba(255, 107, 157, 0.2);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1rem;
            font-weight: 300;
        }

        /* Chat Container */
        .chat-container {
            flex: 1;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 120px);
        }

        .chat-messages {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            scroll-behavior: smooth;
        }

        .message {
            display: flex;
            gap: 1rem;
            max-width: 80%;
            animation: slideIn 0.3s ease;
        }

        .user-message {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .bot-message {
            align-self: flex-start;
        }

        .message-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
            box-shadow: var(--shadow);
        }

        .bot-message .message-avatar {
            background: var(--gradient);
            color: white;
        }

        .user-message .message-avatar {
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
            backdrop-filter: blur(10px);
        }

        .message-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            padding: 1rem 1.5rem;
            border-radius: 20px;
            border: 1px solid rgba(255, 107, 157, 0.2);
            font-size: 0.95rem;
            line-height: 1.6;
            box-shadow: var(--shadow);
        }

        .user-message .message-content {
            background: var(--gradient);
            color: white;
            border: none;
        }

        .message-time {
            font-size: 0.75rem;
            opacity: 0.6;
            margin-top: 0.5rem;
        }

        /* Interactive Buttons */
        .interactive-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            margin-top: 1rem;
        }

        .option-btn {
            background: rgba(255, 107, 157, 0.2);
            border: 1px solid var(--primary);
            border-radius: 20px;
            padding: 0.6rem 1.2rem;
            color: var(--white);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            backdrop-filter: blur(10px);
        }

        .option-btn:hover {
            background: var(--gradient);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.3);
        }

        .whatsapp-btn {
            background: linear-gradient(135deg, #25D366, #128C7E);
            border: none;
            border-radius: 25px;
            padding: 0.8rem 1.5rem;
            color: white;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            margin: 0.5rem 0;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .whatsapp-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(37, 211, 102, 0.4);
        }

        /* Input Area */
        .chat-input {
            padding: 2rem;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 107, 157, 0.2);
        }

        .input-container {
            display: flex;
            gap: 1rem;
            max-width: 900px;
            margin: 0 auto;
        }

        .message-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 107, 157, 0.3);
            border-radius: 25px;
            padding: 1rem 1.5rem;
            color: var(--white);
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .message-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(255, 107, 157, 0.3);
        }

        .message-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .send-button {
            background: var(--gradient);
            border: none;
            border-radius: 50%;
            width: 55px;
            height: 55px;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
        }

        .send-button:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 40px rgba(255, 107, 157, 0.4);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: none;
            align-items: center;
            gap: 1rem;
            max-width: 80%;
            animation: slideIn 0.3s ease;
        }

        .typing-dots {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            padding: 1rem 1.5rem;
            border-radius: 20px;
            border: 1px solid rgba(255, 107, 157, 0.2);
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary);
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        .typing-dot:nth-child(3) { animation-delay: 0s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            margin-bottom: 1rem;
            justify-content: center;
        }

        .quick-action {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 107, 157, 0.3);
            border-radius: 20px;
            padding: 0.6rem 1.2rem;
            color: var(--white);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }

        .quick-action:hover {
            background: var(--gradient);
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.3);
        }

        /* Welcome Message */
        .welcome-message {
            text-align: center;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            margin: 1rem;
            border: 1px solid rgba(255, 107, 157, 0.2);
            backdrop-filter: blur(20px);
        }

        .welcome-message h2 {
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .welcome-message p {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 1.5rem;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .header p {
                font-size: 0.9rem;
            }

            .chat-messages {
                padding: 1rem;
            }

            .chat-input {
                padding: 1rem;
            }

            .message {
                max-width: 95%;
            }

            .message-content {
                padding: 0.8rem 1rem;
                font-size: 0.9rem;
            }

            .quick-actions {
                flex-direction: column;
            }

            .quick-action {
                text-align: center;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gradient);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>💄 DIANA PADILLA ESTÉTICA & SPA</h1>
        <p>Tu Asistente Virtual Inteligente - Pregúntame cualquier cosa</p>
    </header>

    <div class="chat-container">
        <div class="chat-messages" id="chatMessages">
            <div class="welcome-message">
                <h2>¡Bienvenida a Diana Padilla Spa! ✨</h2>
                <p>Soy tu asistente virtual inteligente. Puedo ayudarte con servicios, precios, horarios, ubicación y agendar tu cita perfecta.</p>
                <div class="quick-actions">
                    <div class="quick-action" onclick="showMenuServicios()">🎨 Ver Servicios</div>
                    <div class="quick-action" onclick="showMenuPrecios()">💰 Ver Precios</div>
                    <div class="quick-action" onclick="sendQuickMessage('horarios')">🕐 Horarios</div>
                    <div class="quick-action" onclick="sendQuickMessage('ubicacion')">📍 Ubicación</div>
                    <div class="quick-action" onclick="agendarCitaWhatsApp()">📅 Agendar Cita</div>
                </div>
            </div>

            <div class="typing-indicator" id="typingIndicator">
                <div class="message-avatar">
                    💄
                </div>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
        </div>

        <div class="chat-input">
            <div class="input-container">
                <input 
                    type="text" 
                    class="message-input" 
                    id="messageInput" 
                    placeholder="Pregúntame sobre cortes, manicura, precios, horarios... 💬"
                    onkeypress="handleKeyPress(event)"
                >
                <button class="send-button" id="sendButton" onclick="sendMessage()">
                    ➤
                </button>
            </div>
        </div>
    </div>

    <script>
        // Información completa y detallada del spa
        const spaInfo = {
            nombre: "Diana Padilla Estética & Spa",
            descripcion: "Spa de lujo especializado en belleza y bienestar, donde cada tratamiento es una experiencia única.",
            ubicacion: "Guayaquil, Ecuador",
            telefono: "+593 98 799 3614",
            whatsapp: "593987993614",
            email: "info@dianapaspa.com",
            
            horarios: {
                dias: "Lunes a Sábado",
                horario1: "9:00 AM - 1:00 PM",
                horario2: "2:00 PM - 7:00 PM",
                descanso: "Domingos cerrado"
            },

            servicios: {
                capilar: {
                    nombre: "💇‍♀️ Arte Capilar",
                    descripcion: "Servicios profesionales para tu cabello",
                    items: [
                        { nombre: "Cortes de dama", precio: "Desde $15", descripcion: "Cortes modernos y clásicos para damas" },
                        { nombre: "Cortes de hombre", precio: "Desde $12", descripcion: "Cortes masculinos profesionales" },
                        { nombre: "Alisado con keratina", precio: "$80", descripcion: "Alisado profesional que dura meses" },
                        { nombre: "Ondulaciones", precio: "$25", descripcion: "Ondas perfectas y naturales" },
                        { nombre: "Tintes y rayitos", precio: "Desde $30", descripcion: "Coloración completa, rayitos, marmoleados" },
                        { nombre: "Balayage y californiana", precio: "$60", descripcion: "Técnicas de coloración premium" },
                        { nombre: "Alta frecuencia capilar", precio: "$20", descripcion: "Tratamiento para fortalecer el cabello" },
                        { nombre: "Repolarización capilar", precio: "$35", descripcion: "Reparación profunda del cabello dañado" },
                        { nombre: "Extensiones cosidas", precio: "$100", descripcion: "Extensiones de alta calidad cosidas profesionalmente" },
                        { nombre: "Peinados especiales", precio: "Desde $20", descripcion: "Peinados para eventos y ocasiones especiales" },
                        { nombre: "Pulido de horquillas", precio: "$15", descripcion: "Tratamiento para alisar y dar brillo" }
                    ]
                },
                unas: {
                    nombre: "💅 Manicura & Pedicura",
                    descripcion: "Cuidado profesional para tus uñas",
                    items: [
                        { nombre: "Manicura tradicional", precio: "$12", descripcion: "Manicura clásica con esmaltado" },
                        { nombre: "Manicura en gel", precio: "$18", descripcion: "Manicura con esmalte gel de larga duración" },
                        { nombre: "Pedicura completa", precio: "$20", descripcion: "Cuidado completo para tus pies" },
                        { nombre: "Extensión de uñas", precio: "$25", descripcion: "Uñas más largas y elegantes" },
                        { nombre: "Baby boomer y encapsulados", precio: "$30", descripcion: "Técnicas avanzadas de nail art" },
                        { nombre: "Uñas acrílicas y gel", precio: "$28", descripcion: "Uñas resistentes y duraderas" }
                    ]
                },
                cejas: {
                    nombre: "👁️ Cejas & Pestañas",
                    descripcion: "Realza tu mirada con nuestros tratamientos",
                    items: [
                        { nombre: "Microblading/Microshading", precio: "$120", descripcion: "Cejas perfectas con técnica de micropigmentación" },
                        { nombre: "Lash lifting efecto rimel", precio: "$35", descripcion: "Pestañas curvadas naturalmente" },
                        { nombre: "Cejas con henna", precio: "$15", descripcion: "Tinte natural para cejas más definidas" },
                        { nombre: "Laminado de cejas", precio: "$25", descripcion: "Cejas más voluminosas y ordenadas" },
                        { nombre: "Pestañas punto a punto", precio: "$40", descripcion: "Extensiones de pestañas individuales" },
                        { nombre: "Depilación con hilo", precio: "$8", descripcion: "Depilación precisa y delicada" }
                    ]
                },
                facial: {
                    nombre: "✨ Tratamientos Faciales",
                    descripcion: "Cuidado especializado para tu rostro",
                    items: [
                        { nombre: "Limpieza facial profunda", precio: "$35", descripcion: "Limpieza completa y hidratación facial" },
                        { nombre: "Exfoliación corporal", precio: "$40", descripcion: "Renovación completa de la piel" },
                        { nombre: "Makeup profesional", precio: "Desde $25", descripcion: "Maquillaje para eventos especiales" },
                        { nombre: "Depilación corporal con cera", precio: "Desde $15", descripcion: "Depilación suave y duradera" }
                    ]
                },
                relajacion: {
                    nombre: "🌿 Bienestar & Relajación",
                    descripcion: "Momentos de paz y relajación",
                    items: [
                        { nombre: "Masajes relajantes", precio: "$45", descripcion: "Masajes terapéuticos para tu bienestar" }
                    ]
                }
            },

            // Palabras clave para búsqueda inteligente
            keywords: {
                cortes: ["corte", "cortar", "cabello", "pelo", "tijera"],
                manicura: ["uñas", "manicura", "esmalte", "nail"],
                cejas: ["cejas", "pestañas", "microblading", "henna"],
                facial: ["facial", "limpieza", "cara", "rostro"],
                precios: ["precio", "costo", "cuanto", "valor"],
                horarios: ["hora", "horario", "abierto", "cerrado"],
                ubicacion: ["donde", "ubicacion", "direccion", "lugar"]
            }
        };

        let conversationHistory = [];

        // Función para agendar cita por WhatsApp
        function agendarCitaWhatsApp() {
            const mensaje = "¡Hola Diana! 👋 Quiero agendar una cita en tu spa. ¿Podrías ayudarme con la disponibilidad?";
            const whatsappURL = `https://wa.me/${spaInfo.whatsapp}?text=${encodeURIComponent(mensaje)}`;
            window.open(whatsappURL, '_blank');
        }

        // Función para agendar servicio específico
        function agendarServicioWhatsApp(servicio, precio) {
            const mensaje = `¡Hola Diana! 👋\n\nQuiero agendar una cita para:\n🎨 Servicio: ${servicio}\n💰 Precio: ${precio}\n\n¿Cuál sería la disponibilidad? ¡Gracias!`;
            const whatsappURL = `https://wa.me/${spaInfo.whatsapp}?text=${encodeURIComponent(mensaje)}`;
            window.open(whatsappURL, '_blank');
        }

        // Menús interactivos
        function showMenuServicios() {
            const opciones = Object.keys(spaInfo.servicios).map(key => 
                `<div class="option-btn" onclick="showCategoriaServicios('${key}')">${spaInfo.servicios[key].nombre}</div>`
            ).join('');
            
            addBotMessageWithOptions("🎨 **Nuestros servicios por categorías:**\n\nSelecciona la categoría que te interesa:", opciones);
        }

        function showMenuPrecios() {
            const opciones = Object.keys(spaInfo.servicios).map(key => 
                `<div class="option-btn" onclick="showPreciosCategoria('${key}')">${spaInfo.servicios[key].nombre}</div>`
            ).join('');
            
            addBotMessageWithOptions("💰 **Ver precios por categoría:**\n\nElige la categoría para ver precios detallados:", opciones);
        }

        function showCategoriaServicios(categoria) {
            const cat = spaInfo.servicios[categoria];
            let mensaje = `${cat.nombre}\n\n${cat.descripcion}\n\n`;
            
            cat.items.forEach(item => {
                mensaje += `• **${item.nombre}** - ${item.precio}\n  ${item.descripcion}\n\n`;
            });

            const whatsappBtn = `<button class="whatsapp-btn" onclick="agendarCitaWhatsApp()">📱 Agendar por WhatsApp</button>`;
            addBotMessage(mensaje + whatsappBtn);
        }

        function showPreciosCategoria(categoria) {
            const cat = spaInfo.servicios[categoria];
            let mensaje = `💰 **${cat.nombre} - Precios**\n\n`;
            
            cat.items.forEach(item => {
                mensaje += `• ${item.nombre}: **${item.precio}**\n`;
            });

            const opciones = cat.items.map(item => 
                `<div class="option-btn" onclick="agendarServicioWhatsApp('${item.nombre}', '${item.precio}')">Agendar ${item.nombre}</div>`
            ).join('');

            addBotMessageWithOptions(mensaje, opciones);
        }

        // Inicializar chat
        document.addEventListener('DOMContentLoaded', function() {
            addBotMessage("¡Hola! 👋 Soy tu asistente virtual inteligente de Diana Padilla Estética & Spa.\n\nPuedo ayudarte con:\n✨ Información detallada de servicios\n💰 Precios específicos\n🕐 Horarios y disponibilidad\n📍 Ubicación\n📅 Agendar tu cita\n\n¿En qué puedo ayudarte hoy?");
        });

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function sendQuickMessage(message) {
            addUserMessage(message);
            
            showTyping(true);
            setTimeout(async () => {
                const response = await getBotResponse(message);
                showTyping(false);
                addBotMessage(response);
            }, 1000);
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addUserMessage(message);
            input.value = '';
            
            showTyping(true);
            
            setTimeout(async () => {
                try {
                    const response = await getBotResponse(message);
                    showTyping(false);
                    addBotMessage(response);
                } catch (error) {
                    showTyping(false);
                    addBotMessage("Lo siento, hubo un error. Por favor intenta de nuevo.");
                }
            }, 1200);
        }

        function addUserMessage(message) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user-message';
            
            messageDiv.innerHTML = `
                <div class="message-avatar">👤</div>
                <div class="message-content">
                    ${message}
                    <div class="message-time">${getCurrentTime()}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        function addBotMessage(message) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot-message';
            
            // Procesar botones en el mensaje
            const processedMessage = message.replace(
                /<button([^>]*)>([^<]*)<\/button>/g, 
                '<button $1>$2</button>'
            );
            
            messageDiv.innerHTML = `
                <div class="message-avatar">💄</div>
                <div class="message-content">
                    ${processedMessage}
                    <div class="message-time">${getCurrentTime()}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        function addBotMessageWithOptions(message, options) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot-message';
            
            messageDiv.innerHTML = `
                <div class="message-avatar">💄</div>
                <div class="message-content">
                    ${message}
                    <div class="interactive-options">
                        ${options}
                    </div>
                    <div class="message-time">${getCurrentTime()}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        function showTyping(show) {
            const typingIndicator = document.getElementById('typingIndicator');
            const sendButton = document.getElementById('sendButton');
            
            typingIndicator.style.display = show ? 'flex' : 'none';
            sendButton.disabled = show;
            
            if (show) {
                scrollToBottom();
            }
        }

        function scrollToBottom() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function getCurrentTime() {
            return new Date().toLocaleTimeString('es-ES', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        // Función de inteligencia mejorada para entender consultas
        function findRelevantService(query) {
            const lowerQuery = query.toLowerCase();
            const results = [];
            
            // Buscar en todas las categorías y servicios
            for (const [catKey, categoria] of Object.entries(spaInfo.servicios)) {
                for (const item of categoria.items) {
                    const itemName = item.nombre.toLowerCase();
                    const itemDesc = item.descripcion.toLowerCase();
                    
                    // Verificar coincidencias exactas o parciales
                    if (itemName.includes(lowerQuery) || 
                        itemDesc.includes(lowerQuery) ||
                        lowerQuery.includes(itemName.split(' ')[0]) ||
                        checkKeywordMatch(lowerQuery, itemName)) {
                        results.push({
                            categoria: categoria.nombre,
                            item: item,
                            relevance: calculateRelevance(lowerQuery, itemName, itemDesc)
                        });
                    }
                }
            }
            
            // Ordenar por relevancia
            return results.sort((a, b) => b.relevance - a.relevance);
        }

        function checkKeywordMatch(query, itemName) {
            // Palabras clave específicas para búsqueda inteligente
            const keywords = {
                'corte': ['corte', 'cortes', 'cortar'],
                'manicura': ['manicura', 'uñas', 'esmalte'],
                'pedicura': ['pedicura', 'pies'],
                'cejas': ['cejas', 'ceja'],
                'pestañas': ['pestañas', 'pestaña', 'lash'],
                'facial': ['facial', 'cara', 'rostro'],
                'masaje': ['masaje', 'relajante'],
                'alisado': ['alisado', 'keratina', 'liso'],
                'tinte': ['tinte', 'color', 'rayitos'],
                'microblading': ['microblading', 'micropigmentacion']
            };
            
            for (const [key, values] of Object.entries(keywords)) {
                if (values.some(keyword => query.includes(keyword)) && 
                    itemName.toLowerCase().includes(key)) {
                    return true;
                }
            }
            return false;
        }

        function calculateRelevance(query, itemName, itemDesc) {
            let score = 0;
            const queryWords = query.split(' ');
            const nameWords = itemName.toLowerCase().split(' ');
            
            // Coincidencia exacta en nombre
            if (itemName.toLowerCase() === query) score += 100;
            
            // Coincidencias parciales
            queryWords.forEach(qWord => {
                if (qWord.length > 2) {
                    if (itemName.toLowerCase().includes(qWord)) score += 10;
                    if (itemDesc.toLowerCase().includes(qWord)) score += 5;
                }
            });
            
            return score;
        }

        async function getBotResponse(userMessage) {
            conversationHistory.push({ role: "user", content: userMessage });
            
            const message = userMessage.toLowerCase();
            
            // Respuestas inteligentes para consultas específicas
            
            // Búsqueda de servicios específicos
            if (message.includes('corte') || message.includes('cortar')) {
                const cortesData = spaInfo.servicios.capilar.items.filter(item => 
                    item.nombre.toLowerCase().includes('corte')
                );
                
                let respuesta = "✂️ **Nuestros servicios de cortes:**\n\n";
                cortesData.forEach(corte => {
                    respuesta += `• **${corte.nombre}** - ${corte.precio}\n  ${corte.descripcion}\n\n`;
                });
                
                const opciones = cortesData.map(corte => 
                    `<div class="option-btn" onclick="agendarServicioWhatsApp('${corte.nombre}', '${corte.precio}')">Agendar ${corte.nombre}</div>`
                ).join('');
                
                addBotMessageWithOptions(respuesta, opciones);
                return;
            }

            // Manicura y uñas
            if (message.includes('manicura') || message.includes('uñas') || message.includes('nail')) {
                const manicuraData = spaInfo.servicios.unas;
                
                let respuesta = `${manicuraData.nombre}\n\n${manicuraData.descripcion}\n\n`;
                manicuraData.items.forEach(item => {
                    respuesta += `• **${item.nombre}** - ${item.precio}\n  ${item.descripcion}\n\n`;
                });
                
                const opciones = manicuraData.items.map(item => 
                    `<div class="option-btn" onclick="agendarServicioWhatsApp('${item.nombre}', '${item.precio}')">Agendar ${item.nombre}</div>`
                ).join('');
                
                addBotMessageWithOptions(respuesta, opciones);
                return;
            }

            // Cejas y pestañas
            if (message.includes('cejas') || message.includes('pestañas') || message.includes('microblading')) {
                const cejasData = spaInfo.servicios.cejas;
                
                let respuesta = `${cejasData.nombre}\n\n${cejasData.descripcion}\n\n`;
                cejasData.items.forEach(item => {
                    respuesta += `• **${item.nombre}** - ${item.precio}\n  ${item.descripcion}\n\n`;
                });
                
                const opciones = cejasData.items.map(item => 
                    `<div class="option-btn" onclick="agendarServicioWhatsApp('${item.nombre}', '${item.precio}')">Agendar ${item.nombre}</div>`
                ).join('');
                
                addBotMessageWithOptions(respuesta, opciones);
                return;
            }

            // Búsqueda general de servicios
            const serviciosEncontrados = findRelevantService(message);
            if (serviciosEncontrados.length > 0) {
                let respuesta = "🎯 **Encontré estos servicios para ti:**\n\n";
                
                serviciosEncontrados.slice(0, 5).forEach(resultado => {
                    const item = resultado.item;
                    respuesta += `• **${item.nombre}** - ${item.precio}\n  ${item.descripcion}\n  Categoría: ${resultado.categoria}\n\n`;
                });
                
                const opciones = serviciosEncontrados.slice(0, 3).map(resultado => {
                    const item = resultado.item;
                    return `<div class="option-btn" onclick="agendarServicioWhatsApp('${item.nombre}', '${item.precio}')">Agendar ${item.nombre}</div>`;
                }).join('');
                
                addBotMessageWithOptions(respuesta, opciones);
                return;
            }

            // Precios generales
            if (message.includes('precio') || message.includes('costo') || message.includes('cuanto')) {
                return `💰 **Algunos de nuestros precios principales:**\n\n✂️ **Cortes:**\n• Dama: Desde $15\n• Hombre: Desde $12\n\n💅 **Manicura:**\n• Tradicional: $12\n• En gel: $18\n\n👁️ **Cejas & Pestañas:**\n• Microblading: $120\n• Lash lifting: $35\n\n✨ **Faciales:**\n• Limpieza profunda: $35\n• Makeup: Desde $25\n\n🌿 **Relajación:**\n• Masajes: $45\n\n<button class="whatsapp-btn" onclick="agendarCitaWhatsApp()">📱 Agendar por WhatsApp</button>\n\n¿Te interesa algún servicio en particular?`;
            }

            // Horarios
            if (message.includes('hora') || message.includes('horario') || message.includes('abierto')) {
                return `🕐 **Nuestros horarios de atención:**\n\n📅 **${spaInfo.horarios.dias}:**\n• Mañana: ${spaInfo.horarios.horario1}\n• Tarde: ${spaInfo.horarios.horario2}\n\n🏠 **${spaInfo.horarios.descanso}**\n\n<button class="whatsapp-btn" onclick="agendarCitaWhatsApp()">📱 Agendar mi cita</button>\n\n¿Te gustaría reservar algún horario específico?`;
            }

            // Ubicación
            if (message.includes('ubicacion') || message.includes('donde') || message.includes('direccion')) {
                return `📍 **Nuestra ubicación:**\n${spaInfo.ubicacion}\n\n📞 **Contacto directo:**\n• Teléfono: ${spaInfo.telefono}\n• WhatsApp: ${spaInfo.telefono}\n• Email: ${spaInfo.email}\n\n<button class="whatsapp-btn" onclick="agendarCitaWhatsApp()">📱 Escribir por WhatsApp</button>\n\n¿Necesitas indicaciones específicas para llegar?`;
            }

            // Agendar citas
            if (message.includes('cita') || message.includes('reserva') || message.includes('agendar')) {
                const opciones = `
                    <div class="option-btn" onclick="showMenuServicios()">Ver todos los servicios</div>
                    <div class="option-btn" onclick="agendarCitaWhatsApp()">Agendar ahora</div>
                `;
                
                addBotMessageWithOptions(`📅 **¡Perfecto! Te ayudo a agendar tu cita:**\n\n🎯 **Opciones disponibles:**\n• Puedes explorar nuestros servicios primero\n• O agendar directamente por WhatsApp\n\n🕐 **Disponibilidad:**\n${spaInfo.horarios.dias} de ${spaInfo.horarios.horario1} y ${spaInfo.horarios.horario2}`, opciones);
                return;
            }

            // Respuesta de Claude AI como fallback
            try {
                const prompt = `Eres el asistente virtual de Diana Padilla Estética & Spa. Un cliente te pregunta: "${userMessage}"\n\nINFORMACIÓN COMPLETA DEL SPA:\n\nSERVICIOS:\n${Object.values(spaInfo.servicios).map(cat => `${cat.nombre}:\n${cat.items.map(item => `• ${item.nombre} - ${item.precio}: ${item.descripcion}`).join('\n')}`).join('\n\n')}\n\nHORARIOS: ${spaInfo.horarios.dias} de ${spaInfo.horarios.horario1} y ${spaInfo.horarios.horario2}. ${spaInfo.horarios.descanso}.\n\nUBICACIÓN: ${spaInfo.ubicacion}\nCONTACTO: ${spaInfo.telefono}\n\nResponde de manera profesional, amigable y útil. Incluye emojis. Máximo 120 palabras. Si es apropiado, sugiere agendar por WhatsApp.`;

                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 300,
                        messages: [{ role: "user", content: prompt }]
                    })
                });

                if (!response.ok) throw new Error('API error');

                const data = await response.json();
                let botResponse = data.content[0].text;
                
                // Agregar botón de WhatsApp si es apropiado
                if (message.includes('agendar') || message.includes('cita') || message.includes('precio')) {
                    botResponse += '\n\n<button class="whatsapp-btn" onclick="agendarCitaWhatsApp()">📱 Agendar por WhatsApp</button>';
                }
                
                conversationHistory.push({ role: "assistant", content: botResponse });
                return botResponse;
                
            } catch (error) {
                return getLocalFallbackResponse(userMessage);
            }
        }

        function getLocalFallbackResponse(userMessage) {
            const responses = [
                `¡Hola! 😊 Soy tu asistente de Diana Padilla Spa. Puedo ayudarte con:\n\n✨ Información de servicios\n💰 Precios detallados\n🕐 Horarios\n📍 Ubicación\n📅 Agendar citas\n\n¿En qué te puedo ayudar específicamente?`,
                `🎨 **En Diana Padilla Spa tenemos:**\n\n💇‍♀️ Arte Capilar\n💅 Manicura & Pedicura\n👁️ Cejas & Pestañas\n✨ Tratamientos Faciales\n🌿 Masajes & Relajación\n\n<button class="whatsapp-btn" onclick="agendarCitaWhatsApp()">📱 Agendar por WhatsApp</button>\n\n¿Qué servicio te interesa?`
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }
    </script>
</body>
</html>
